version: '3.8'

services:
  database:
    image: mcr.microsoft.com/mssql/server:2019-latest
    container_name: mp-database
    environment:
      ACCEPT_EULA: "Y"
      SA_PASSWORD: "${DB_PASSWORD}"
    ports:
      - "${DB_PORT}:${DB_PORT}"
    volumes:
      - ./backend/src/database:/scripts
      - sqlserver_data:/var/opt/mssql
    restart: unless-stopped

  backend:
    build: ./backend
    container_name: mp-backend  
    ports:
      - "${PORT}:${PORT}"
    environment:
      DB_SERVER: "${DB_SERVER}"
      DB_PORT: "${DB_PORT}"
      DB_NAME: "${DB_NAME}"
      DB_USER: "${DB_USER}"
      DB_PASSWORD: "${DB_PASSWORD}"
      PORT: "${PORT}"
    depends_on:
      - database
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      args:
        # URL del backend API (usar localhost con el puerto expuesto para acceso desde el navegador)
        - VITE_API_URL=${API_URL:-http://localhost:${PORT}}
    container_name: mp-frontend
    ports:
      - "${FRONTEND_PORT:-3000}:80"
    depends_on:
      - backend
    restart: unless-stopped

volumes:
  sqlserver_data: